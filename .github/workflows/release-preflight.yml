name: Release Pre-flight Checks

on:
  pull_request:
    branches:
      - release

jobs:
  preflight:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Pre-flight checks
        run: |
          echo "üîç Running pre-flight checks for release..."
          
          # Check git status (should be clean for PR)
          if [[ -n $(git status --porcelain) ]]; then
            echo "‚ùå Error: Git working directory is not clean"
            echo "Uncommitted changes:"
            git status --short
            echo ""
            echo "Please commit all changes before creating PR to release"
            exit 1
          fi
          
          # Check CHANGELOG has been updated
          if ! grep -q "## \[Unreleased\]" CHANGELOG.md; then
            echo "‚ö†Ô∏è  Warning: No [Unreleased] section in CHANGELOG.md"
            echo "Consider adding release notes before merging to release"
          fi
          
          # Check version in package.json
          VERSION=$(node -p "require('./package.json').version")
          echo "üì¶ Current version: $VERSION"
          
          if [[ $VERSION == *"-"* ]]; then
            echo "‚úÖ Version has build suffix (will be stripped during publish)"
          fi
          
          echo "‚úÖ All pre-flight checks passed"
